<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/atb.css">
    <title>Rowley ATB</title>
</head>
<body>
<div class="page-wrapper">
    <header>
        <div class="container">
            <div class="row">
                <div class="col nr-start-menu">
                    <button id="start-btn">START</button>
                    <button id="menu-btn">MENU/PAUSE</button>
                </div>
            </div>
        </div>
    </header>
    <main>
        <div class="container">
            <div class="row">
                <div class="col">
                    <p id="info-field"></p>
                </div>
                <div class="col">
                    <ul class="enemies" id="enemies">
                        <li class="enemy-icon" id="enemy-4"></li>
                        <li class="enemy-icon" id="enemy-2"></li>
                        <li class="enemy-icon" id="enemy-1"></li>
                        <li class="enemy-icon" id="enemy-3"></li>
                        <li class="enemy-icon" id="enemy-5"></li>
                    </ul>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <div class="container">
            <div class="row">
                <div class="col">
                    <button id="attack-btn">ATTACK</button>
                </div>
                <div class="menu-area" id="menu-area">
                    <p>INSTRUCTIONS/MENU/SETTINGS/ETC</p>
                </div>
            </div>
        </div>
    </footer>
</div>

<script>
    // PLAYER AND ENEMY OBJECTS
    let player = {
        id: 'player',
        stats: {
            hp: 10,
            sp: 2,
            str: 0,
            def: 0,
            spd: 0,
            luck: 0,
        },
        actions: {
            maxActions: 3,
            currentActions: 0,
        }
    };
    let enemy = {
        id: 'enemy',
        stats: {
            hp: 10,
            sp: 2,
            str: 0,
            def: 0,
            spd: 0,
            luck: 0,
        },
        actions: {
            maxActions: 3,
            currentActions: 0,
        }
    };

    //GET VARIABLES FOR GAME OBJECTS
    let startBtn = document.getElementById('start-btn');
    let menuBtn = document.getElementById('menu-btn');
    let attackBtn = document.getElementById('attack-btn');
    attackBtn.disabled = true;

    //GAME VARIABLES
    let playerActionGaugeId;

    //Functions
    let damageCalculator = function (attackerStr, targetDef) {
        let damage = (attackerStr + Math.floor(Math.random() * (6 - 1) + 1)) - targetDef;
        if (damage < 0) {
            return 0;
        } else {
            return damage;
        }
    }
    let playerAttack = function () {
        console.log('player attack');
        player.actions.currentActions--;
        console.log(`Action Used. Actions remaining: ${player.actions.currentActions}`);
        if (playerActionGaugeId === null) {
            playerActionGaugeId = setInterval(playerActionGauge, 2000 - (player.stats.spd * 10));
        }
        if (player.actions.currentActions === 0) {
            attackBtn.disabled = true;
        }
    };
    function playerActionGauge() {
        if (player.actions.currentActions < player.actions.maxActions) {
            player.actions.currentActions++;
            console.log(`Player Actions: ${player.actions.currentActions}, Player Maximum Actions: ${player.actions.maxActions}`);
            attackBtn.disabled = false;
        } else if (player.actions.currentActions === player.actions.maxActions) {
            clearInterval(playerActionGaugeId);
            playerActionGaugeId = null;
        }
    }
    function startGame() {
        playerActionGaugeId = setInterval(playerActionGauge, 2000 - (player.stats.spd * 10));
        startBtn.disabled = true;
        if(player.actions.currentActions > 0){
            attackBtn.disabled = false;
        }
        console.log(`GAME START/RESUMED`)
    }
    function pauseGame() {
        clearInterval(playerActionGaugeId);
        playerActionGaugeId = null;
        startBtn.disabled = false;
        attackBtn.disabled = true;
        console.log(`GAME PAUSED`)
    }
    //Event Listeners and Inputs
    //click events
    attackBtn.addEventListener('click', playerAttack);
    startBtn.addEventListener('click', startGame);
    menuBtn.addEventListener('click', pauseGame)
    //keyboard events
    document.addEventListener('keydown', (event) => {
        let keyCode = event.code;
        console.log(keyCode);
        if (keyCode === "KeyA") {
            playerAttack();
        }
    })
</script>
</body>
</html>